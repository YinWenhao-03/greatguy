# 完整部署和配置指南

## 一、宝塔面板数据库创建指南

### 1. 登录宝塔面板
- 打开浏览器，访问您的宝塔面板地址
- 输入用户名和密码登录

### 2. 创建数据库
1. 点击左侧菜单的 **"数据库"**
2. 点击 **"添加数据库"** 按钮
3. 填写数据库信息：
   - **数据库名**: `blog`
   - **用户名**: `root` (或创建新用户)
   - **密码**: 使用您的数据库密码 (如: YH2RS46awfxtMeSb)
   - **访问权限**: 本地服务器
4. 点击 **"提交"** 完成数据库创建

### 3. 验证数据库创建
- 在数据库列表中应该能看到刚创建的 `blog` 数据库
- 点击 **"管理"** 可以进入 phpMyAdmin 查看

---

## 二、代码修改指南

### 1. 修改环境变量配置

编辑项目根目录的 `.env` 文件：

```env
# 数据库连接配置
DATABASE_URL="mysql://root:YH2RS46awfxtMeSb@127.0.0.1:3306/blog"

# 如果您的数据库不在本地，使用公网IP：
# DATABASE_URL="mysql://root:YH2RS46awfxtMeSb@49.235.142.138:3306/blog"
```

**注意**：
- 替换 `YH2RS46awfxtMeSb` 为您的实际数据库密码
- 如果数据库在本地，使用 `127.0.0.1`
- 如果数据库在远程服务器，使用实际的 IP 地址

### 2. 安装依赖和执行数据库迁移

在宝塔面板的终端中执行以下命令：

```bash
# 1. 进入项目目录
cd /www/wwwroot/49.235.142.138

# 2. 删除旧的依赖（如果有问题）
rm -rf node_modules
rm package-lock.json

# 3. 重新安装依赖
npm install --registry https://registry.npmmirror.com

# 4. 执行数据库迁移（创建表结构）
npx prisma db push

# 5. 初始化管理员账号
npx ts-node scripts/init-db.ts
```

### 3. 构建项目

```bash
# 构建生产版本
npm run build
```

### 4. 启动项目

```bash
# 使用 PM2 启动项目（推荐）
npm install -g pm2
pm2 start npm --name "yinwenhao-portfolio" -- start

# 或者直接启动
npm run start
```

---

## 三、宝塔面板项目配置

### 1. 创建网站
1. 点击左侧菜单的 **"网站"**
2. 点击 **"添加站点"**
3. 填写站点信息：
   - **域名**: 输入您的域名或 IP (如: 49.235.142.138)
   - **数据库**: 不创建（我们已经手动创建了）
   - **PHP版本**: 纯静态
4. 点击 **"提交"**

### 2. 配置 Node.js 项目
1. 在网站列表中找到刚创建的站点
2. 点击 **"设置"**
3. 点击 **"Node.js"** 标签
4. 配置 Node.js 项目：
   - **项目目录**: `/www/wwwroot/49.235.142.138`
   - **启动文件**: `npm`
   - **启动参数**: `start`
   - **项目名称**: `yinwenhao-portfolio`
5. 点击 **"保存"**
6. 点击 **"启动"** 按钮启动项目

### 3. 配置反向代理（如果需要）
1. 在网站设置中点击 **"反向代理"**
2. 点击 **"添加反向代理"**
3. 配置代理：
   - **代理名称**: `nextjs`
   - **目标URL**: `http://127.0.0.1:3000`
   - **发送域名**: `$host`
4. 点击 **"提交"**

---

## 四、后台管理功能使用说明

### 1. 访问后台管理
- 访问: `http://您的域名/admin`
- 使用管理员账号登录：
  - 用户名: `yinwenhao`
  - 密码: `20030822yin`

### 2. 作品管理
#### 添加作品
1. 登录后台后，点击 **"作品管理"**
2. 点击 **"添加作品"**
3. 填写作品信息：
   - **标题**: 作品标题
   - **副标题**: 作品副标题
   - **URL标识**: 用于访问的 URL (如: my-first-work)
   - **封面图片**: 可以上传或输入图片 URL
   - **标签**: 用逗号分隔 (如: 设计, 开发, 产品)
   - **状态**: 已完成 / 即将推出
   - **简介**: 作品简介
   - **画廊图片**: 多个图片 URL，用逗号分隔
4. 点击 **"创建作品"**

#### 编辑作品
1. 在作品列表中找到要编辑的作品
2. 点击 **"编辑"** 按钮
3. 修改作品信息
4. 点击 **"更新作品"**

#### 删除作品
1. 在作品列表中找到要删除的作品
2. 点击 **"删除"** 按钮
3. 确认删除

### 3. 博客管理
- 点击 **"博客管理"** 进入博客页面
- 管理员可以创建新博客文章

---

## 五、常见问题

### 1. 数据库连接失败
- 检查 `.env` 文件中的数据库连接信息是否正确
- 确认数据库服务是否启动
- 检查防火墙是否允许数据库端口访问

### 2. 端口被占用
- 修改 `package.json` 中的启动端口
- 或者停止占用端口的进程

### 3. 图片上传失败
- 确认 `public/uploads` 目录存在且有写入权限
- 检查文件大小是否超限

### 4. PM2 管理命令
```bash
# 查看项目状态
pm2 status

# 查看日志
pm2 logs yinwenhao-portfolio

# 重启项目
pm2 restart yinwenhao-portfolio

# 停止项目
pm2 stop yinwenhao-portfolio

# 删除项目
pm2 delete yinwenhao-portfolio
```

---

## 六、文件结构说明

新增的重要文件：

```
src/
├── app/
│   ├── admin/
│   │   ├── page.tsx                    # 管理后台首页
│   │   └── works/
│   │       ├── page.tsx                # 作品列表管理
│   │       ├── create/
│   │       │   └── page.tsx            # 添加作品页面
│   │       └── [id]/
│   │           └── edit/
│   │               └── page.tsx        # 编辑作品页面
│   └── api/
│       ├── works/
│       │   ├── route.ts                # 作品列表 API
│       │   └── [id]/
│       │       └── route.ts            # 作品详情 API
│       └── upload/
│           └── route.ts                # 图片上传 API
prisma/
└── schema.prisma                        # 更新了数据库模型
public/
└── uploads/                             # 图片上传目录（自动创建）
```

---

## 七、技术支持

如果遇到问题，请检查：
1. 宝塔面板的日志文件
2. PM2 的日志输出
3. 浏览器控制台的错误信息

祝您使用愉快！
